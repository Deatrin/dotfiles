# Hosts

This directory contains per-machine system-level configurations for both NixOS and nix-darwin hosts.

## Organization

- **common/darwin/**: Shared macOS configurations (defaults, homebrew integration)
- **common/nixos/**: Shared NixOS configurations (locale, nix settings, openssh, tailscale)
- **common/optional/**: Optional modules (docker, podman, fonts, plex, jellyseerr, vscode-server)
- **common/containers/**: Docker compose configurations for containerized services
- **darwin/**: Per-host macOS configurations
- **nixos/**: Per-host NixOS configurations
- **VMtemplate/**: Template for VM setup

## Active Hosts

### NixOS (Linux)

- **[nauvoo](nixos/nauvoo/README.md)**: VM with GPU, media server (Plex, Jellyseerr)
  - x86_64-linux, AMD CPU, NVIDIA GPU
  - Docker, Plex, Jellyseerr, VSCode Server
  - NFS mount for media storage

- **[razerback](nixos/razerback/README.md)**: Dell Precision 5760 laptop with Hyprland
  - x86_64-linux, Intel CPU, Thunderbolt
  - Docker, Hyprland desktop, Auto-upgrade enabled
  - LUKS encrypted storage

- **[tycho](nixos/tycho/README.md)**: Lenovo T14 G3 laptop with Hyprland
  - x86_64-linux, Intel CPU, Thunderbolt
  - Podman, Hyprland desktop
  - LUKS + LVM + BTRFS storage
  - Opnix secrets management (system-level)

### Darwin (macOS)

- **[barkeith](darwin/barkeith/README.md)**: Intel MacBook Pro (ajennex)
  - x86_64-darwin
  - Standard configuration with Homebrew integration

- **[chetzemoka](darwin/chetzemoka/README.md)**: M2 MacBook Air (ajennex)
  - aarch64-darwin (Apple Silicon)
  - Standard configuration with Homebrew integration

- **[donnager](darwin/donnager/README.md)**: iMac Pro (ajennex)
  - x86_64-darwin
  - Standard configuration with Homebrew integration

- **[tynan](darwin/tynan/README.md)**: M1 MacBook (deatrin)
  - aarch64-darwin (Apple Silicon)
  - Opnix secrets management (system-level)
  - Different dock configuration

## Adding a New Host

With the flake-parts architecture, adding a new host only requires editing `flake/hosts.nix`:

### NixOS Host

```nix
myNewServer = {
  system = "x86_64-linux";
  user = "username";
  modules = [../hosts/nixos/myNewServer];
};
```

Then create the directory structure:

```bash
mkdir -p hosts/nixos/myNewServer
```

Create these files in the new directory:
- `default.nix` - Main host configuration
- `hardware-configuration.nix` - Hardware-specific settings (generated by nixos-generate-config)
- `disko-config.nix` - Disk partitioning configuration (optional)
- `secrets.nix` - Opnix secrets configuration (optional)
- `README.md` - Host-specific documentation

### Darwin Host

```nix
myNewMac = {
  system = "aarch64-darwin";  # or x86_64-darwin for Intel
  user = "username";
  modules = [../hosts/darwin/myNewMac];
};
```

Then create the directory structure:

```bash
mkdir -p hosts/darwin/myNewMac
```

Create these files in the new directory:
- `default.nix` - Main host configuration
- `homebrew.nix` - Homebrew packages and casks
- `secrets.nix` - Opnix secrets configuration (optional)
- `README.md` - Host-specific documentation

## Common Configuration Inheritance

All hosts automatically inherit common configurations:

**All NixOS Hosts Include:**
- Home-manager integration
- Opnix support (1Password integration)
- Tailscale VPN
- OpenSSH server
- NFS client support
- YubiKey/U2F support
- Bluetooth and power management
- Automatic system updates (optional per-host)

**All Darwin Hosts Include:**
- Home-manager integration
- Opnix support (1Password integration)
- Homebrew package management
- Nix flakes and experimental features
- Custom fonts (Monaspace, JetBrains Mono Nerd Fonts)
- Touch ID for sudo authentication
- System defaults (dark mode, fast key repeat, etc.)

## Documentation

For detailed architecture documentation, build commands, and development workflow, see [CLAUDE.md](../CLAUDE.md).

For host-specific setup instructions, refer to the individual README files linked above.
